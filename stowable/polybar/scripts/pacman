#!/usr/bin/env bash

# Requires sudoers set to NOPASSWD
# Comment out if you'd rather run manually
sudo pacman -Sy > /dev/null 2>&1

# We use this instead of checkupdates so that
# our `aurupdates` command is kept up to date
pacupdates=$(pacman -Sup | wc -l)

if command -v yay > /dev/null; then
    aurupdates=$(yay -Qum 2>/dev/null | wc -l)
elif command -v pacaur > /dev/null; then
    # Pacaur includes ignored packages so we need to grep them out
    aurupdates=$(pacaur -Qum 2>/dev/null | grep -c -v '[ ignored ]')
else
    aurupdates=0
fi

if (( pacupdates == 0 )) && (( aurupdates == 0 )); then
    echo ""
    exit
fi

fgcolor=""
if (( pacupdates <= 10 )); then
    fgcolor="#ffffff"
elif (( pacupdates <= 25 )); then
    fgcolor="#CCFF00"
elif (( pacupdates <= 50 )); then
    fgcolor="#ffb52a"
elif (( pacupdates <= 75 )); then
    fgcolor="#bd2c40"
elif (( pacupdates < 100 )); then
    fgcolor="#ff0000"
fi

fmt="%{F${fgcolor}}"

if (( pacupdates >= 100 )); then
    pacupdates+=" (!!)"
    fmt+="%{F${fgcolor}}%{B#bd2c40}"
elif (( pacupdates > 10 )); then
    fmt+="%{u${fgcolor}}"
fi

echo -n "${fmt}   ïŒƒ  ${pacupdates}"

if (( aurupdates > 0 )); then
    echo -n "+$aurupdates"
fi

echo "   %{F-}%{u-}"
